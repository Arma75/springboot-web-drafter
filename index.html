<!DOCTYPE html>
<html>
    <style>
        body {
            background-color: #e8eef7;
        }
        table {
            border-collapse: collapse;
        }
        th {
            padding: 12px 16px;
            background-color: #f5f6fa;
            border: 1px solid #eef1f8;
            font-weight: 400;
            font-size: 16px;
            color: #abb0bf;
            text-align: left;
        }
        th:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        th:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        td {
            padding: 12px 16px;
            background-color: #fff;
            border: 1px solid #e5ebf4;
        }
        td:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        td:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
    </style>
    <body>
        <article>
            <h4>Team Name</h4>
            <input type="text" id="teamName" name="teamName" value="coupang">
        </article>

        <article>
            <h4>Project Name</h4>
            <input type="text" id="projectName" name="projectName" value="springboot-project">
        </article>

        <article>
            <h4>Description</h4>
            <input type="text" id="description" name="description" value="Spring Boot project">
        </article>

        <article>
            <h4>Table</h4>
            <input type="text" id="tableName" name="tableName" value="user">

            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Length</th>
                        <th>Default</th>
                        <th>PK</th>
                        <th>Nullable</th>
                        <th>Increment</th>
                        <th>Remove</th>
                    </tr>
                </thead>

                <tbody>
                    <tr class="columnRow1">
                        <td>
                            <input type="text" name="columnName" value="id">
                        </td>
                        <td>
                            <select>
                                <option value="BIGINT">BIGINT</option>
                                <option value="INT">INT</option>
                                <option value="VARCHAR">VARCHAR</option>
                                <option value="TEXT">TEXT</option>
                                <option value="DATETIME">DATETIME</option>
                                <option value="DATE">DATE</option>
                                <option value="BOOLEAN">BOOLEAN</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="columnLength" value="20">
                        </td>
                        <td>
                            <input type="text" name="columnDefault" value="">
                        </td>
                        <td>
                            <input type="checkbox" name="columnPK" checked>
                        </td>
                        <td>
                            <input type="checkbox" name="columnNullable">
                        </td>
                        <td>
                            <input type="checkbox" name="columnIncrement" checked>
                        </td>
                        <td>
                            <button class="columnRemoveButton" onclick="removeRow(1)">Remove</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button id="columnAddButton">Add Column</button>
        </article>
        
        <button onclick="generateProject()" style="background-color: #5b7cfd;">생성하기</button>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

        <script>
            const columnAddButton = document.getElementById("columnAddButton");
            columnAddButton.addEventListener("click", function() {
                const tbody = document.querySelector("table tbody");
                const newRow = document.createElement("tr");

                const rowId = Date.now();
                newRow.classList.add(`columnRow${rowId}`);
                newRow.innerHTML = `
                <td>
                    <input type="text" name="columnName" value="id">
                </td>
                <td>
                    <select>
                        <option value="BIGINT">BIGINT</option>
                        <option value="INT">INT</option>
                        <option value="VARCHAR">VARCHAR</option>
                        <option value="TEXT">TEXT</option>
                        <option value="DATETIME">DATETIME</option>
                        <option value="DATE">DATE</option>
                        <option value="BOOLEAN">BOOLEAN</option>
                    </select>
                </td>
                <td>
                    <input type="text" name="columnLength" value="20">
                </td>
                <td>
                    <input type="text" name="columnDefault" value="">
                </td>
                <td>
                    <input type="checkbox" name="columnPK" checked>
                </td>
                <td>
                    <input type="checkbox" name="columnNullable">
                </td>
                <td>
                    <input type="checkbox" name="columnIncrement" checked>
                </td>
                <td>
                    <button onclick="removeRow(${rowId})">Remove</button>
                </td>`;
                tbody.appendChild(newRow);
            });

            function removeRow(rowNumber) {
                const row = document.querySelector(`.columnRow${rowNumber}`);
                if (row) {
                    row.remove();
                }
            }
            
            async function generateProject() {
                const teamName = document.getElementById("teamName").value;
                const projectName = document.getElementById("projectName").value;
                const description = document.getElementById("description").value;
                const groupName = "com." + teamName;

                const zip = new JSZip();
                const packageName = groupName + "." + projectName;
                const packagePath = packageName.replace(/\./g, '/');

                // 최상위 폴더 생성
                const projectFolder = zip.folder(projectName);

                // build.gradle 파일 추가
                projectFolder.file("build.gradle", getBuildGradleContent(groupName, description, 17));
                // settings.gradle 파일 추가
                projectFolder.file("settings.gradle", getSettingsGradleContent(projectName));
                // README.md 파일 추가
                projectFolder.file("README.md", getReadMeContent(projectName, description));
                // gradlew 파일 추가
                projectFolder.file("gradlew", readFile("./assets/gradlew"));
                // gradlew.bat 파일 추가
                projectFolder.file("gradlew.bat", readFile("./assets/gradlew.bat"));
                
                // gradle 폴더 생성
                projectFolder.folder(`gradle/wrapper`);
                // gradle 관련 파일 추가
                projectFolder.file("gradle/wrapper/gradle-wrapper.jar", readFile("./assets/gradle-wrapper.jar"));
                projectFolder.file("gradle/wrapper/gradle-wrapper.properties", readFile("./assets/gradle-wrapper.properties"));

                // resources 폴더 생성
                projectFolder.folder(`src/main/resources`);
                // application.properties 파일 추가
                projectFolder.file("src/main/resources/application.properties", `spring.application.name=${projectName}`);

                projectFolder.folder(`src/main/java/${packagePath}`);
                // Application.java 파일 추가
                const applicationClassName = projectName.charAt(0).toUpperCase() + projectName.slice(1) + "Application";
                projectFolder.file(`src/main/java/${packagePath}/${applicationClassName}.java`, getApplicationJavaContent(applicationClassName, packageName));

                projectFolder.folder(`src/main/java/${packagePath}/controller`);
                const controllerClassName = projectName.charAt(0).toUpperCase() + projectName.slice(1) + "Controller";
                projectFolder.file(`src/main/java/${packagePath}/controller/${controllerClassName}.java`, getControllerContent(controllerClassName, packageName));

                projectFolder.folder(`src/main/java/${packagePath}/dto`);

                // 압축 파일 생성 및 다운로드
                const content = await zip.generateAsync({ type: "blob" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(content);
                link.download = `${projectName}.zip`;
                link.click();
            }

            function getBuildGradleContent(groupName, description, javaVersion) {
                let buildGradleContent = "";
                buildGradleContent += `plugins {\n`
                buildGradleContent += `    id 'java'\n`
                buildGradleContent += `    id 'org.springframework.boot' version '3.5.9'\n`
                buildGradleContent += `    id 'io.spring.dependency-management' version '1.1.7'\n`
                buildGradleContent += `}\n`
                buildGradleContent += `\n`
                buildGradleContent += `group = '${groupName}'\n`
                buildGradleContent += `version = '0.0.1-SNAPSHOT'\n`
                buildGradleContent += `description = '${description}'\n`
                buildGradleContent += `\n`
                buildGradleContent += `java {\n`
                buildGradleContent += `    toolchain {\n`
                buildGradleContent += `        languageVersion = JavaLanguageVersion.of(${javaVersion})\n`
                buildGradleContent += `    }\n`
                buildGradleContent += `}\n`
                buildGradleContent += `\n`
                buildGradleContent += `repositories {\n`
                buildGradleContent += `    mavenCentral()\n`
                buildGradleContent += `}\n`
                buildGradleContent += `\n`
                buildGradleContent += `dependencies {\n`
                buildGradleContent += `    implementation 'org.springframework.boot:spring-boot-starter-web'\n`
                buildGradleContent += `}`;
                
                return buildGradleContent;
            }

            function getSettingsGradleContent(projectName) {
                let settingsGradleContent = "";
                settingsGradleContent += `rootProject.name = '${projectName}'\n`;

                return settingsGradleContent;
            }

            function getReadMeContent(projectName, description) {
                let readmeContent = "";
                readmeContent += `# ${projectName}\n`;
                readmeContent += `\n`;
                readmeContent += `${description}`;
                
                return readmeContent;
            }

            function getApplicationJavaContent(applicationClassName, packageName) {
                let applicationJavaContent = "";
                applicationJavaContent += `package ${packageName};\n`
                applicationJavaContent += `\n`
                applicationJavaContent += `import org.springframework.boot.SpringApplication;\n`
                applicationJavaContent += `import org.springframework.boot.autoconfigure.SpringBootApplication;\n`
                applicationJavaContent += `\n`
                applicationJavaContent += `@SpringBootApplication\n`
                applicationJavaContent += `public class ${applicationClassName} {\n`
                applicationJavaContent += `    public static void main(String[] args) {\n`
                applicationJavaContent += `        SpringApplication.run(${applicationClassName}.class, args);\n`
                applicationJavaContent += `    }\n`
                applicationJavaContent += `}`;

                return applicationJavaContent;
            }

            function getControllerContent(controllerClassName, packageName) {
                let controllerContent = "";
                controllerContent += `package ${packageName}.controller;\n`
                controllerContent += `\n`
                controllerContent += `import org.springframework.http.ResponseEntity;\n`
                controllerContent += `import org.springframework.web.bind.annotation.*;\n`
                controllerContent += `\n`
                controllerContent += `@RestController\n`
                controllerContent += `@RequestMapping("")\n`
                controllerContent += `public class ${controllerClassName} {\n`
                controllerContent += `    public ResponseEntity<?> create(Map<String, Object> dto) {\n`
                controllerContent += `        return ResponseEntity.status(201).body("");\n`
                controllerContent += `    }\n`
                controllerContent += `}`;

                return controllerContent;
            }
            
            async function readFile(filePath) {
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error('파일을 찾을 수 없습니다. 경로를 확인해주세요.');
                    }

                    return await response.arrayBuffer();
                } catch (error) {
                    console.error("❌ 오류 발생:", error);
                    return null;
                }
            }
        </script>
    </body>
</html>